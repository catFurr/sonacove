---
// @ts-expect-error 
import { generateRoomWithoutSeparator } from '@jitsi/js-utils/random';
import Layout from "../layouts/Layout.astro";

// Demo purposes only (replace with auth logic later)
const isLoggedIn = true;

const userData = {
  name: "Josim Uddin",
  email: "josim.design@gmail.com",
  plan: "Trialing",
  avatarUrl: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
};

const meetingsList = [
  { date: "August 25, 2025", title: "Design Workshop with Ibrahim", time: "8:20 PM", status: "Upcoming" },
  { date: "August 25, 2025", title: "Design Workshop with Ibrahim", time: "8:20 PM", status: "Upcoming" },
  { date: "August 26, 2025", title: "Project Sync-Up", time: "10:00 AM", status: "Upcoming" },
  { date: "August 27, 2025", title: "Marketing Brainstorm", time: "3:30 PM", status: "Upcoming" }
];

// Generate random placeholder words
const placeholderWords = Array.from({ length: 10 }, () => generateRoomWithoutSeparator());
const initialRoomPlaceholder = placeholderWords[0];

// Environment variables
const env = {
  PUBLIC_KC_HOSTNAME: import.meta.env.PUBLIC_KC_HOSTNAME,
  PUBLIC_PADDLE_ENVIRONMENT: import.meta.env.PUBLIC_PADDLE_ENVIRONMENT,
  PUBLIC_PADDLE_CLIENT_TOKEN: import.meta.env.PUBLIC_PADDLE_CLIENT_TOKEN,
  PUBLIC_PADDLE_PRICE_ID: import.meta.env.PUBLIC_PADDLE_PRICE_ID
};
---

<Layout title="Sonacove Meets">
  <div class="bg-gray-50 min-h-screen p-4">
    {!isLoggedIn ? (
      <!-- Logged Out State -->
      <div class="container px-4 py-8 mx-auto text-center">
        <!-- logged out content -->
      </div>
    ) : (
      <div class="w-full max-w-[1700px] mx-auto px-8">
        <!-- Header -->
        <div class="w-full flex justify-center pt-4 mb-8">
          <header class="w-full flex justify-between items-center px-6 py-3 bg-white rounded-full border border-gray-200 shadow-sm">
            <div class="flex items-center gap-4">
              <img src="/sonacove-orange.svg" alt="Sonacove Logo" class="w-10 h-8" />
              <span class="text-2xl font-semibold text-black">Sonacove</span>
            </div>
            <div class="flex items-center">
              <img src={userData.avatarUrl} alt={userData.name} class="w-10 h-10 rounded-full object-cover" />
            </div>
          </header>
        </div>

        <!-- Main Content Grid -->
        <main class="grid grid-cols-1 lg:grid-cols-5 gap-[10vw] items-start pt-8 mt-4">
          <!-- Left Column -->
          <div class="lg:col-span-2">
            <h1 class="text-6xl font-semibold text-black mb-6 leading-tight">
              Secure and high quality meetings
            </h1>
            <p class="text-xl text-gray-600 mb-20">
              The only online meeting platform that adapts to your teaching style, not the other way around.
            </p>

            <form id="room-form" class="max-w-lg">
              <div class="relative w-full">
                <input
                  id="room-input"
                  type="text"
                  placeholder="Enter here"
                  class="w-full bg-transparent border-0 border-b border-gray-300 py-3 pl-3 text-3xl font-medium text-gray-800 placeholder-gray-400 focus:outline-none focus:ring-0 focus:border-orange-500 transition-colors"
                />
              </div>
              <p class="mt-3 mb-8 text-sm text-gray-500">
                Enter subject or Meeting ID to get started
              </p>
              <div class="flex items-center gap-4">
                <button
                  type="submit"
                  class="px-8 py-4 bg-orange-500 text-white font-semibold rounded-full hover:bg-orange-600 shadow-sm transition-transform hover:scale-105"
                >
                  Join meeting
                </button>
                <button
                  type="button"
                  class="px-8 py-4 bg-black text-white font-semibold rounded-full hover:bg-gray-800 shadow-sm transition-transform hover:scale-105"
                >
                  Book meeting
                </button>
              </div>
            </form>
          </div>

          <!-- Right Column -->
          <div class="bg-white rounded-3xl p-6 border border-gray-200 shadow-sm lg:col-span-3">
            <div class="bg-gray-100 p-5 py-8 rounded-2xl flex justify-between items-start mb-8">
              <div class="flex gap-4">
                <img src={userData.avatarUrl} alt={userData.name} class="w-16 h-16 rounded-full object-cover" />
                <div class="flex flex-col gap-1">
                  <h3 class="text-2xl font-semibold text-black">{userData.name}</h3>
                  <p class="leading-tight">
                    {userData.email.replace(".com", ".\ncom")}
                  </p>
                  <p class="text-xl text-gray-500 mt-2 pt-4">
                    Plan: <span class="font-bold text-black">{userData.plan}</span>
                  </p>
                </div>
              </div>
              <div class="flex flex-col gap-2 flex-shrink-0">
                <button class="px-7 py-3.5 border-4 border-orange-500 text-orange-500 text-m font-semibold rounded-full hover:bg-orange-50 transition-colors">
                  Manage Account
                </button>
                <button class="px-7 py-3.5 border-4 border-black text-black text-m font-semibold rounded-full hover:bg-gray-100 transition-colors">
                  Manage Plan
                </button>
              </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-8 mb-6 border-b border-gray-200">
              <button class="flex-1 pb-3 text-lg font-semibold text-orange-500 border-b-2 border-orange-500">
                My Meetings
              </button>
              <button class="flex-1 pb-3 text-lg font-semibold text-gray-400 hover:text-orange-500">
                Recordings
              </button>
              <button class="flex-1 pb-3 text-lg font-semibold text-gray-400 hover:text-orange-500">
                Notes
              </button>
            </div>

            <!-- Filters -->
            <div class="inline-flex bg-gray-100 rounded-md p-1 space-x-1 mb-6">
              <button class="px-7 py-3 bg-white text-black font-semibold rounded-md shadow-sm text-sm transition-colors">
                All
              </button>
              <button class="px-7 py-3 text-gray-500 font-semibold hover:text-black rounded-md text-sm transition-colors">
                Upcoming
              </button>
              <button class="px-7 py-3 text-gray-500 font-semibold hover:text-black rounded-md text-sm transition-colors">
                Past
              </button>
            </div>

            <!-- Meetings List -->
            <div class="space-y-4 min-h-[400px]">
              {meetingsList.map((meeting) => (
                <div class="flex items-center gap-24 p-4 border-b border-gray-100 last:border-b-0">
                  <div class="text-left">
                    <p class="font-semibold text-xl text-slate-700">{meeting.date}</p>
                    <p class="text-gray-500 text-xl">{meeting.time}</p>
                  </div>
                  <div class="text-left">
                    <p class="text-2xl text-black mb-2">{meeting.title}</p>
                    <span class="inline-flex items-center gap-2 bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-sm">
                      <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                        <path
                          fill-rule="evenodd"
                          clip-rule="evenodd"
                          d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        />
                      </svg>
                      {meeting.status}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </main>
      </div>
    )}
  </div>

  <!-- Animation Script -->
  <script is:inline define:vars={{ placeholderWords }}>
    const input = document.getElementById("room-input");
    let currentWord;
    if (input) {
      let wordIndex = 0;
      let timeoutId = null;
      const typingSpeed = 100, erasingSpeed = 50, pauseDuration = 1500;

      const type = (word, onDone) => {
        let i = 0;
        if (document.activeElement !== input) input.placeholder = "";
        const typeChar = () => {
          if (i < word.length) {
            input.placeholder += word.charAt(i++);
            timeoutId = setTimeout(typeChar, typingSpeed);
          } else if (onDone) onDone();
        };
        typeChar();
      };

      const erase = (onDone) => {
        const word = input.placeholder;
        let i = word.length;
        const eraseChar = () => {
          if (i > 0) {
            input.placeholder = word.substring(0, --i);
            timeoutId = setTimeout(eraseChar, erasingSpeed);
          } else if (onDone) onDone();
        };
        eraseChar();
      };

      const animationLoop = () => {
        currentWord = placeholderWords[wordIndex];
        type(currentWord, () => {
          timeoutId = setTimeout(() => {
            erase(() => {
              wordIndex = (wordIndex + 1) % placeholderWords.length;
              animationLoop();
            });
          }, pauseDuration);
        });
      };
      window.addEventListener("DOMContentLoaded", animationLoop);
    }

    const roomForm = document.getElementById("room-form");
    if (roomForm) {
      roomForm.addEventListener("submit", (event) => {
        event.preventDefault();
        if (currentWord) window.location.href = `/meet/${currentWord}`;
      });
    }
  </script>

  <!-- Custom Styling -->
  <style>
    .bg-orange-500 { background-color: #F05023; }
    .hover\:bg-orange-600:hover { background-color: #D8431C; }
    .text-orange-500 { color: #F05023; }
    .text-orange-600 { color: #D9480F; }
    .border-orange-500 { border-color: #F05023; }
    .bg-orange-100 { background-color: #FFF4E6; }
    .hover\:bg-orange-50:hover { background-color: #FFF9F2; }
    .focus\:ring-orange-400:focus { --tw-ring-color: #F05023; }
    .text-green-600 { color: #16A34A; }
    .bg-gray-50 { background-color: #F9FAFB; }
  </style>
</Layout>
