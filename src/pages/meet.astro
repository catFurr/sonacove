---
// @ts-expect-error
import { generateRoomWithoutSeparator } from '@jitsi/js-utils/random';
import Layout from "../layouts/Layout.astro";
import WelcomeContent from '../components/WelcomeContent.astro';

// Demo purposes only
const isLoggedIn = true;

const userData = {
  name: "Josim Uddin",
  email: "josim.design@gmail.com",
  plan: "Trialing",
  avatarUrl:
    "data:image/png;base64,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"
};

const meetingsList = [
  { date: "August 25, 2025", title: "Design Workshop with Ibrahim", time: "8:20 PM", status: "Upcoming" },
  { date: "August 25, 2025", title: "Design Workshop with Ibrahim", time: "8:20 PM", status: "Upcoming" },
  { date: "August 26, 2025", title: "Project Sync-Up", time: "10:00 AM", status: "Upcoming" },
  { date: "August 27, 2025", title: "Marketing Brainstorm", time: "3:30 PM", status: "Upcoming" }
];

const placeholderWords = Array.from({ length: 10 }, () => generateRoomWithoutSeparator());
const initialRoomPlaceholder = placeholderWords[0];

const env = {
  PUBLIC_KC_HOSTNAME: import.meta.env.PUBLIC_KC_HOSTNAME,
  // ...other env variables
};
---

<Layout title="Sonacove Meets">
  <div class="bg-gradient-to-b from-[#F3F3F3] to-[#FAFAFA] min-h-screen p-4">
    <div class="w-full max-w-[1700px] mx-auto px-8">
      <!-- SHARED HEADER STRUCTURE -->
      <div class="w-full flex justify-center pt-4 mb-8">
        <header class="w-full flex justify-between items-center px-6 py-3 bg-white rounded-full border border-gray-200 shadow-sm">
          <div class="flex items-center gap-4">
            <img src="/sonacove-orange.svg" alt="Sonacove Logo" class="w-10 h-8" />
            <span class="text-2xl font-semibold text-black">Sonacove</span>
          </div>

          <!-- CONDITIONAL HEADER BUTTONS -->
          {isLoggedIn ? (
            <div class="flex items-center">
              <img src={userData.avatarUrl} alt={userData.name} class="w-10 h-10 rounded-full object-cover" />
            </div>
          ) : (
            <div class="flex items-center gap-4">
              <button class="px-7 py-3 bg-black text-white font-semibold rounded-full hover:bg-gray-800 transition-colors">
                Log in
              </button>
              <button class="px-7 py-3 bg-orange-500 text-white font-semibold rounded-full hover:bg-orange-600 transition-colors">
                Sign up
              </button>
            </div>
          )}
        </header>
      </div>

      <!-- CONDITIONAL MAIN CONTENT -->
      {isLoggedIn ? (
        <main class="grid grid-cols-1 lg:grid-cols-5 gap-[10vw] items-start pt-8 mt-4">
          <div class="lg:col-span-2">
            <WelcomeContent {initialRoomPlaceholder} />
          </div>

          <!-- Right Column (Logged In) -->
          <div class="bg-white rounded-3xl p-6 border border-gray-200 shadow-sm lg:col-span-3">
            <div class="bg-gray-100 p-5 py-8 rounded-2xl flex justify-between items-start mb-8">
              <div class="flex gap-4">
                <img src={userData.avatarUrl} alt={userData.name} class="w-16 h-16 rounded-full object-cover" />
                <div class="flex flex-col gap-1">
                  <h3 class="text-2xl font-semibold text-black">{userData.name}</h3>
                  <p class="leading-tight">{userData.email.replace(".com", ".\ncom")}</p>
                  <p class="text-xl text-gray-500 mt-2 pt-4">
                    Plan: <span class="font-bold text-black">{userData.plan}</span>
                  </p>
                </div>
              </div>
              <div class="flex flex-col gap-2 flex-shrink-0">
                <button class="px-7 py-3.5 border-4 border-orange-500 text-orange-500 text-m font-semibold rounded-full hover:bg-orange-50 transition-colors">
                  Manage Account
                </button>
                <button class="px-7 py-3.5 border-4 border-black text-black text-m font-semibold rounded-full hover:bg-gray-100 transition-colors">
                  Manage Plan
                </button>
              </div>
            </div>

            <!-- Tabs -->
            <div class="flex gap-8 mb-6 border-b border-gray-200">
              <button class="flex-1 pb-3 text-lg font-semibold text-orange-500 border-b-2 border-orange-500">
                My Meetings
              </button>
              <button class="flex-1 pb-3 text-lg font-semibold text-gray-400 hover:text-orange-500">
                Recordings
              </button>
              <button class="flex-1 pb-3 text-lg font-semibold text-gray-400 hover:text-orange-500">
                Notes
              </button>
            </div>

            <!-- Filters -->
            <div class="inline-flex bg-gray-100 rounded-md p-1 space-x-1 mb-6">
              <button class="px-7 py-3 bg-white text-black font-semibold rounded-md shadow-sm text-sm transition-colors">All</button>
              <button class="px-7 py-3 text-gray-500 font-semibold hover:text-black rounded-md text-sm transition-colors">Upcoming</button>
              <button class="px-7 py-3 text-gray-500 font-semibold hover:text-black rounded-md text-sm transition-colors">Past</button>
            </div>

            <!-- Meetings List -->
            <div class="space-y-4 min-h-[400px]">
              {meetingsList.map((meeting) => (
                <div class="flex items-center gap-24 p-4 border-b border-gray-100 last:border-b-0">
                  <div class="text-left">
                    <p class="font-semibold text-xl text-slate-700">{meeting.date}</p>
                    <p class="text-gray-500 text-xl">{meeting.time}</p>
                  </div>
                  <div class="text-left">
                    <p class="text-2xl text-black mb-2">{meeting.title}</p>
                    <span class="inline-flex items-center gap-2 bg-green-100 text-green-800 text-xs font-semibold px-3 py-1.5 rounded-sm">
                      <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor">
                        <path
                          fillRule="evenodd"
                          clipRule="evenodd"
                          d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                        />
                      </svg>
                      {meeting.status}
                    </span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </main>
      ) : (
        <main class="grid grid-cols-1 lg:grid-cols-2 gap-[5vw] items-center pt-8 mt-4">
          <div>
            <WelcomeContent {initialRoomPlaceholder} />
          </div>
          <!-- Right Column (Logged Out) -->
          <div class="hidden lg:flex justify-center items-center w-auto h-full">
            <img src="/logged-out-illustration.png" alt="Illustration..." class="max-w-full max-h-full object-contain" />
          </div>
        </main>
      )}
    </div>
  </div>

  <!-- Animation Script -->
  <script is:inline define:vars={{ placeholderWords }}>
    const input = document.getElementById("room-input");
    let currentWord;
    if (input) {
      let wordIndex = 0;
      let timeoutId = null;
      const typingSpeed = 100,
        erasingSpeed = 50,
        pauseDuration = 1500;

      const type = (word, onDone) => {
        let i = 0;
        if (document.activeElement !== input) input.placeholder = "";
        const typeChar = () => {
          if (i < word.length) {
            input.placeholder += word.charAt(i++);
            timeoutId = setTimeout(typeChar, typingSpeed);
          } else if (onDone) onDone();
        };
        typeChar();
      };

      const erase = (onDone) => {
        const word = input.placeholder;
        let i = word.length;
        const eraseChar = () => {
          if (i > 0) {
            input.placeholder = word.substring(0, --i);
            timeoutId = setTimeout(eraseChar, erasingSpeed);
          } else if (onDone) onDone();
        };
        eraseChar();
      };

      const animationLoop = () => {
        currentWord = placeholderWords[wordIndex];
        type(currentWord, () => {
          timeoutId = setTimeout(() => {
            erase(() => {
              wordIndex = (wordIndex + 1) % placeholderWords.length;
              animationLoop();
            });
          }, pauseDuration);
        });
      };
      window.addEventListener("DOMContentLoaded", animationLoop);
    }

    const roomForm = document.getElementById("room-form");
    if (roomForm) {
      roomForm.addEventListener("submit", (event) => {
        event.preventDefault();
        if (currentWord) window.location.href = `/meet/${currentWord}`;
      });
    }
  </script>

  <!-- Custom Styling -->
  <style>
    .bg-orange-500 {
      background-color: #F05023;
    }
    .hover\:bg-orange-600:hover {
      background-color: #D8431C;
    }
    .text-orange-500 {
      color: #F05023;
    }
    .text-orange-600 {
      color: #D9480F;
    }
    .border-orange-500 {
      border-color: #F05023;
    }
    .bg-orange-100 {
      background-color: #FFF4E6;
    }
    .hover\:bg-orange-50:hover {
      background-color: #FFF9F2;
    }
    .focus\:ring-orange-400:focus {
      --tw-ring-color: #F05023;
    }
    .text-green-600 {
      color: #16A34A;
    }
    .bg-gray-50 {
      background-color: #F9FAFB;
    }
  </style>
</Layout>
